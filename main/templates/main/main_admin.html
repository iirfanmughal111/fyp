{% extends 'main/admin_basic.html' %}
{%load static%}
{% block title%}Add new user{% endblock%}
{% block design %}
<style>
    .hide{
        display: none !important;
    }
</style>
  {%endblock%}
{% block body%}



<div class="row mt-5">

    <div class="col-lg-2">
        <nav class="nav flex-column mt-5">
            <a class="nav-link my-link fw-bold tab-link" data-bs-toggle="tab" href="#users">Users</a>
            <a class="nav-link my-link fw-bold tab-link" data-bs-toggle="tab" href="#devices">Devices</a>
            <a class="nav-link my-link fw-bold tab-link" data-bs-toggle="tab" href="#sensors">Sensors</a>
            <a class="nav-link my-link fw-bold tab-link" data-bs-toggle="tab" href="#log">Log</a>
            <a class="nav-link my-link fw-bold tab-link" data-bs-toggle="tab" href="#ticketing">Ticketing</a>
        </nav>

    </div>
    <div class="col-lg-10">
        <!-- TabContent -->
        <div class="tab-content">
            <div class="tab-pane active" id="#">
                {%load static%}
                <img src="{% static 'member/images/uog.jpg' %}" class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- Usesr Tab -->
            <div class="tab-pane mt-5" id="users">

                <!-- All user list in input fields -->
                <div class="row border border-2 rounded">
                    <div class="col-12 d-flex rounded-pill justify-content-end align-items-end">
                        <a href="export_user_csv" class="btn my-3 me-5 btn-primary " role="button">Export Users As CSV
                            <i class="fa-solid ms-1 fa-file-export"></i> </a>
                        <!-- <a href="add_new_user" class="btn my-3 me-5 btn-primary " role="button">Add new <i
                                class="fa-solid fa-plus"></i> </a> -->
                        <button type="button" class="btn my-3 me-5 btn-primary" data-bs-toggle="modal"
                            data-bs-whatever="{{user.username}}" id="btn_del" data-bs-target="#btn_add_user">
                            Add new <i class="fa-solid fa-plus"></i>
                        </button>



                    </div>
                </div>

                <div class="col-12">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Username</th>
                                <th scope="col">First Name</th>
                                <th scope="col">Last Name</th>
                                <th scope="col">Email</th>

                            </tr>
                        </thead>
                        <tbody>

                            {% for user in users%}
                            <tr>
                                <th scope="row">{{user.id}}</th>
                                <td>{{user.username}}</td>
                                <td>{{user.first_name}}</td>
                                <td>{{user.last_name}}</td>
                                <td>{{user.email}}</td>
                                <td>
                                    <a href="user_change/{{user.id}}" class="btn ms-3  btn-primary" role="button">View<i
                                            class="fa-solid ms-1 fa-pen-to-square"></i></a>
                                </td>
                                <td><button type="button" class="btn btn-danger" data-bs-toggle="modal"
                                        data-bs-whatever="{{user.username}}" id="btn_del"
                                        data-bs-target="#btn_del_modal">
                                        Delete<i class="fa-solid ms-1 fa-trash-can"></i>
                                    </button></td>
                            </tr>
                            {%endfor%}

                        </tbody>
                    </table>
                </div>


                <!-- AddNewUserModal -->
                <div class="modal fade " id="btn_add_user" tabindex="-1" aria-labelledby="AddUserModal"
                    aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="AddUserModal">Add new User</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <div class="row d-flex my-5 justify-content-center">
                                    <div class="col-11 rounded shadow">
                                        <h1 class="mb-5 text-center">Add new User</h1>
                                        {% if form.errors %}
                                        {% for field in form %}
                                        {% for error in field.errors %}
                                        <div class="alert alert-danger">
                                            <strong>{{ error|escape }}</strong>
                                        </div>
                                        {% endfor %}
                                        {% endfor %}

                                        {% for error in form.non_field_errors %}
                                        <div class="alert alert-danger">
                                            <strong>{{ error|escape }}</strong>
                                        </div>
                                        {% endfor %}

                                        {% endif %}


                                        <form method="POST" action="">
                                            {{form.as_p}}
                                            {% csrf_token %}
                                            <br>
                                            <button type="submit" class="btn btn-primary"
                                                data-bs-dismiss="modal">Submit</button>
                                        </form>
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <p>Fotter</p>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- EndNewUserModal -->

                <!-- Delete User modal  -->

                <div class="modal fade" id="btn_del_modal" tabindex="-1" aria-labelledby="deleteModal"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModal">Set in JS</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <h4 id="del_id" class="text-danger"></h4>
                                <p style="opacity: 0.7;" class="fs-5">Make sure this user will permanently deleted. You
                                    can deactive this user instead. To deactive just uncheck the "Active Status" from
                                    permissions tab and submit.</p>

                            </div>
                            <div class="modal-footer">
                                <!-- Href Set in JS -->
                                <a href="#" class="btn btn-danger" id="del_user_btn" role="button">Delete<i
                                        class="fa-solid ms-1 fa-trash-can"></i></a>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>

                            </div>
                        </div>
                    </div>
                </div>
                <!--End Delete User modal  -->
                <!-- Nested Horizantol NavTab -->






            </div>
            <!-- Usesr Tab End -->


            <!-- Devices Tab -->

            <div class="tab-pane " id="devices">

                <div class="row border border-2 rounded">
                    <div class="col-12 d-flex rounded-pill justify-content-end align-items-end">
                        <a href="#" class="btn my-3 me-5 btn-primary " role="button">Export Devices As CSV
                            <i class="fa-solid ms-1 fa-file-export"></i> </a>

                        <button type="button" class="btn my-3 me-5 btn-primary" id="btn_add_device">
                            Add new <i class="fa-solid fa-plus"></i>
                        </button>

                    </div>
                </div>
                <!-- AddNewDeviceForm -->
                <div class="row my-5 border border-3 rounded shadow p-5 hide" id="device_form">
                    <div class="col-12">
                        <div class="row d-flex justify-content-end">
                            <div class="col-auto"><button class="btn btn-outline-danger btn-close" id="device_cancel"></button></div>
                        </div>
                        <form action="" method="POST">
                            <label for="" class="form-label"> Vehicle #</label>
                            <input class="form-control" type="number" name="vehicle_no" id="">
                            <label for="" class="form-label"> Route Name</label>
                            <input class="form-control" type="text" name="route_name"><br>
                            <label for="" class="form-label">  Temperature</label>
                            <input class="form-check-input" type="checkbox" name="temperature">
                            <label for="" class="form-label"> Carbon Mono </label>
                            <input class="form-check-input" type="checkbox" name="carbon_mono">
                            <label for="" class="form-label"> Humidity</label>
                            <input class="form-check-input" type="checkbox" name="humidity">
                            <label for="" class="form-label"> Light </label>
                            <input class="form-check-input" type="checkbox" name="light">
                            <label for="" class="form-label"> Noise </label>
                            <input class="form-check-input" type="checkbox" name="noise">
                            <label for="" class="form-label"> longitude</label>
                            <input class="form-check-input" type="checkbox" name="longitude">
                            <label for="" class="form-label"> latitude</label>
                            <input class="form-check-input" type="checkbox" name="latitude"><br>
                            <button class="btn btn-outline-primary" type="submit">Save</button>
                        </form>
                    </div>
                </div>
                <!-- <div class="row">
                    <div class="col-2">
                        <h6>Vehicle #</h6><input type="number" name="vehicle_no" id="">
                    </div>
                    <div class="col-2">
                        <h6>Route Name</h6> <input type="text" name="route_name">
                    </div>
                    <div class="col-2">
                        <h6>temperature</h6><input type="checkbox" name="temperature">
                    </div>
                    <div class="col-1">
                        <h6>CO</h6><input type="checkbox" name="carbon_mono">
                    </div>
                    <div class="col-1">
                        <h6>Humidity</h6><input type="checkbox" name="humidity">
                    </div>
                    <div class="col-1">
                        <h6>Light</h6><input type="checkbox" name="light">
                    </div>
                    <div class="col-1">
                        <h6>Noise</h6><input type="checkbox" name="noise">
                    </div>
                    <div class="col-1">
                        <h6>Long</h6><input type="checkbox" name="longitude">
                    </div>
                    <div class="col-1">
                        <h6>Lati</h6><input type="checkbox" name="latitude">
                    </div>

                </div> -->



                <!-- AllDevicesList -->
                <div class="row my-5">
                    <div class="col-12">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Vehicle</th>
                                    <th scope="col">Route</th>
                                    <th scope="col">temp</th>
                                    <th scope="col">CO</th>
                                    <th scope="col">Humidity</th>
                                    <th scope="col">Light</th>
                                    <th scope="col">Noise</th>
                                    <th scope="col">long</th>
                                    <th scope="col">lat</th>

                                </tr>
                            </thead>
                            <tbody>

                                {% for device in devices%}
                                <tr>
                                    <th scope="row">{{device.device_id}}</th>
                                    <td>{{device.vehicle_no}}</td>
                                    <td>{{device.route_name}}</td>
                                    <td>{{device.temperature}}</td>
                                    <td>{{device.carbon_mono}}</td>
                                    <td>{{device.humidity}}</td>
                                    <td>{{device.light}}</td>
                                    <td>{{device.noise}}</td>
                                    <td>{{device.langitude}}</td>
                                    <td>{{device.latitude}}</td>
                                </tr>
                                {%endfor%}

                            </tbody>
                        </table>
                    </div>
                </div>

                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- Devices Tab End -->



            <!-- Sensors Tab  -->

            <div class="tab-pane " id="sensors">
                all sensors with their device id
                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- Sensors Tab End -->

            <!-- Log Tab  -->

            <div class="tab-pane " id="log">
                all sensors log
                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- Log Tab End -->

            <!-- Tickting Tab  -->

            <div class="tab-pane " id="ticketing">
                <div class="row my-5">
                    <div class="col-12 my-3">
                        <form class="d-flex">
                            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                            <button class="btn btn-outline-success" type="submit">Search</button>
                        </form>
                    </div>
                    <!-- mainRow -->
                    <div class="row">
                        <div class="col-12">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Username</th>
                                        <th scope="col">Devices</th>
                                        <th scope="col">temp</th>
                                        <th scope="col">CO</th>
                                        <th scope="col">Humidity</th>
                                        <th scope="col">Light</th>
                                        <th scope="col">Noise</th>
                                        <th scope="col">GPS</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    {% for user in users%}
                                    {% if not user.is_superuser%}
                                    <tr>
                                        <th scope="row">{{user.id}}</th>
                                        <td>{{user.username}}</td>
                                        <td>

                                            <select class="form-select" aria-label="Default select example">
                                                <option selected disabled>Select device</option>
                                                {% for device in devices%}
                                                <option value="{{device.device_id}}">{{device.device_id}}
                                                    {{device.route_name}}</option>
                                                {%endfor%}
                                            </select>
                                        </td>


                                        <td>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                    id="flexSwitchCheckChecked" checked>
                                            </div>
                                        </td>

                                        <td>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                    id="flexSwitchCheckChecked" checked>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                    id="flexSwitchCheckChecked" checked>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                    id="flexSwitchCheckChecked" checked>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                    id="flexSwitchCheckChecked" checked>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                    id="flexSwitchCheckChecked" checked>
                                            </div>
                                        </td>
                                    </tr>
                                    {%endif%}
                                    {%endfor%}

                                </tbody>
                            </table>
                        </div>
                    </div>


                </div>




                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- ticketing Tab End -->


        </div>
        <!-- End Tab Content -->
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
<script>

    // DeleteUserModal 
    var deleteModal = document.getElementById('btn_del_modal')
    deleteModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var user_name = button.getAttribute('data-bs-whatever');
        var modalTitle = deleteModal.querySelector('.modal-title');
        var modalBodyText = deleteModal.querySelector('.modal-body #del_id');
        modalTitle.textContent = " Delete '" + user_name + "' ?";
        modalBodyText.textContent = " Are you sure to delete user with username' " + user_name + "' ? ";
        del_user_id = document.getElementById('del_user_btn');
        var btn_link = "delete_user/" + user_name;
        del_user_id.textContent = " Delete ' " + user_name + " '";
        del_user_id.setAttribute("href", btn_link);
    });

    // TicketingTabJs

    // SelectUserJs

    // SelectDeviceJS
// DevicesTabJs

var btn_add_dev = document.getElementById('btn_add_device');
var btn_dev_cancel = document.getElementById('device_cancel')
var dev_form = document.getElementById('device_form');
btn_add_dev.addEventListener('click',()=>{
    dev_form.classList.remove('hide');
});
btn_dev_cancel.addEventListener('click',()=>{
    dev_form.classList.add('hide');
});
</script>
{% endblock %}
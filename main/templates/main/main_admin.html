{% extends 'main/admin_basic.html' %}
{%load static%}
{% block title%}Admin Panel{% endblock%}
{% block design %}
<style>
    .hide {
        display: none !important;
    }
</style>
{%endblock%}
{% block fluid%}


<!-- MainWork -->
<div class="row  mt-5 " style="min-height: 800px;">

    <div class="col-lg-2 sidebar px-4">
        <div class="row my-5 pt-5">
            <div class="col-12">
                <h3 class="text-white text-center">Vehicle Data <br>Acquisition System</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
            </div>
            <nav class="nav flex-column mt-5">
                <a class="nav-link my-link my-2 fw-bold rounded  border " data-bs-toggle="tab" href="#home">Home</a>
                <a class="nav-link my-link my-2 fw-bold rounded border " data-bs-toggle="tab" href="#users">Users</a>
                <a class="nav-link my-link my-2 fw-bold rounded border" data-bs-toggle="tab" href="#devices">Devices</a>
                <a class="nav-link my-link my-2 fw-bold rounded border" data-bs-toggle="tab" href="#sensors">Sensors</a>
                <a class="nav-link my-link my-2 fw-bold rounded border" data-bs-toggle="tab" href="#log">Log</a>
                <a class="nav-link my-link my-2 fw-bold rounded border" data-bs-toggle="tab"
                    href="#ticketing">Ticketing</a>
            </nav>
        </div>

    </div>
    <div class="col-lg-10 px-3">
        <!-- TabContent -->
        <div class="tab-content">
            <div class="tab-pane active" id="home">
                <div class="row d-flex justify-content-evenly">
                    <div class="col-3 border border-primary rounded dashboard_box gradient_priamary">
                        <div class="row ">
                            <div
                                class="col-12 justify-content-center text-white flex-column d-flex align-items-center dashboard_box">
                                <h4>Total Users</h4>
                                <i class="fa-solid fa-3x my-3 fa-users-line"></i>
                                <h2>{{totalUser}}</h2>
                            </div>
                        </div>

                    </div>
                    <div class="col-3 border border-primary rounded dashboard_box gradient_secondary">
                        <div class="row ">
                            <div
                                class="col-12 justify-content-center text-white flex-column d-flex align-items-center dashboard_box">
                                <h4>Total Devices</h4>
                                <i class="fa-solid fa-3x my-3 fa-memory"></i>
                                <h2>{{totaldevices}}</h2>
                            </div>
                        </div>

                    </div>
                    <div class="col-3 border border-primary rounded dashboard_box gradient_thired">
                        <div class="row ">
                            <div
                                class="col-12 justify-content-center text-white flex-column d-flex align-items-center dashboard_box">
                                <h4>Total Sensors</h4>
                                <i class="fa-solid fa-3x my-3 fa-microchip"></i>
                                <h2>0</h2>
                            </div>
                        </div>

                    </div>



                </div>
                <div class="row d-flex justify-content-center">
                    <div class="col-8">
                        {%load static%}
                        <img src="{% static 'member/images/uog.jpg' %}" class="img-fluid m-5 rounded-circle"
                            alt="uog-img">
                    </div>
                </div>


            </div>

            <!-- Usesr Tab -->
            <div class="tab-pane mt-5" id="users" role="tabpanel" aria-labelledby="users-tab">

                <!-- All user list in input fields -->
                <div class="row border border-2 rounded">
                    <div class="col-12 d-flex rounded-pill justify-content-end align-items-end">
                        <a href="export_user_csv" class="btn my-3 ms-5 btn-primary " role="button">Export Users As CSV
                            <i class="fa-solid ms-1 fa-file-export"></i> </a>
                        <!-- <a href="add_new_user" class="btn my-3 ms-5 btn-primary " role="button">Add new <i
                                class="fa-solid fa-plus"></i> </a> -->
                        <button type="button" class="btn my-3 ms-5 btn-primary" data-bs-toggle="modal"
                            data-bs-whatever="{{user.username}}" id="btn_del" data-bs-target="#btn_add_user">
                            Add new user<i class="fa-solid fa-plus"></i>
                        </button>



                    </div>
                </div>
                <div class="row my-5">
                    <div class="col-12">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Username</th>
                                    <th scope="col">First Name</th>
                                    <th scope="col">Last Name</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">View</th>
                                    <th scope="col">Delete</th>



                                </tr>
                            </thead>
                            <tbody id="user_tbody">

                                {% for user in users%}
                                <tr class="usersCount">
                                    <!-- <th scope="row">{{user.id}}</th> -->
                                    <th scope="row">{{ forloop.counter }}</th>
                                    <td>{{user.username}}</td>
                                    <td>{{user.first_name}}</td>
                                    <td>{{user.last_name}}</td>
                                    <td>{{user.email}}</td>
                                    <td>
                                        <a href="user_change/{{user.id}}" class="btn ms-3  btn-primary"
                                            role="button">View<i class="fa-solid ms-1 fa-pen-to-square"></i></a>
                                    </td>
                                    <td><button type="button" class="btn btn-danger" data-bs-toggle="modal"
                                            data-bs-whatever="{{user.username}}" id="btn_del"
                                            data-bs-target="#btn_del_modal">
                                            Delete<i class="fa-solid ms-1 fa-trash-can"></i>
                                        </button></td>
                                </tr>
                                {%endfor%}

                            </tbody>
                            
                        </table>
                        <div class="row d-flex justify-content-center">
                                <div class="col-2">
                                    <a type="button" class="btn btn-primary" id="btn_load_more">Load more</a>
                                </div>
                            </div>
                    </div>
                </div>


                <!-- AddNewUserModal -->
                <div class="modal fade " id="btn_add_user" tabindex="-1" aria-labelledby="AddUserModal"
                    aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="AddUserModal">Add new User</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <div class="row d-flex my-5 justify-content-center">
                                    <div class="col-11 rounded shadow">
                                        <h1 class="mb-5 text-center">Add new User</h1>
                                        {% if form.errors %}
                                        {% for field in form %}
                                        {% for error in field.errors %}
                                        <div class="alert alert-danger">
                                            <strong>{{ error|escape }}</strong>
                                        </div>
                                        {% endfor %}
                                        {% endfor %}

                                        {% for error in form.non_field_errors %}
                                        <div class="alert alert-danger">
                                            <strong>{{ error|escape }}</strong>
                                        </div>
                                        {% endfor %}

                                        {% endif %}


                                        <form method="POST" action="">
                                            {{form.as_p}}
                                            {% csrf_token %}
                                            <br>
                                            <button type="submit" class="btn btn-primary"
                                                data-bs-dismiss="modal">Submit</button>
                                        </form>
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <p>Fotter</p>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- EndNewUserModal -->

                <!-- Delete User modal  -->

                <div class="modal fade" id="btn_del_modal" tabindex="-1" aria-labelledby="deleteModal"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModal">Set in JS</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <h4 id="del_id" class="text-danger"></h4>
                                <p style="opacity: 0.7;" class="fs-5">Make sure this user will permanently deleted. You
                                    can deactive this user instead. To deactive just uncheck the "Active Status" from
                                    permissions tab and submit.</p>

                            </div>
                            <div class="modal-footer">
                                <!-- Href Set in JS -->
                                <a href="#" class="btn btn-danger" id="del_user_btn" role="button">Delete<i
                                        class="fa-solid ms-1 fa-trash-can"></i></a>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>

                            </div>
                        </div>
                    </div>
                </div>
                <!--End Delete User modal  -->
                <!-- Nested Horizantol NavTab -->






            </div>
            <!-- Usesr Tab End -->


            <!-- Devices Tab -->

            <div class="tab-pane " id="devices">

                <div class="row border border-2 rounded">
                    <div class="col-12 d-flex rounded-pill justify-content-end align-items-end">
                        <a href="#" class="btn my-3 ms-5 btn-primary " role="button">Export Devices As CSV
                            <i class="fa-solid ms-1 fa-file-export"></i> </a>

                        <button type="button" class="btn my-3 ms-5 btn-primary" id="btn_add_device">
                            Add new <i class="fa-solid fa-plus"></i>
                        </button>

                    </div>


                </div>
                <div class="row hide" id="dev_success_alert">
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>Congratulations!</strong> Action performed successfully on device in record.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>

                    <div class="col-12"><h6  class="hide mt-5 mb-2 alert alert-danger">Alert handle by JS</h6></div>
                </div>
                <div class="row hide" id="dev_error_alert">
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>Erorr!</strong> something went wrong try agian latter..
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>

                    
                </div>
                <!-- AddNewDeviceForm -->
                <div class="row my-5 border border-3 rounded shadow p-5 hide" id="device_form">

                    <div class="col-12">

                        

                        <div class="row d-flex justify-content-end">
                            <div class="col-auto"><button class="btn btn-outline-danger btn-close"
                                    id="device_cancel"></button></div>
                        </div>
                        <form id="dev_form" method="POST">
                            {% csrf_token %}
                            {{deviceForm}}
                            <button class="btn btn-primary ms-5" id="btn_device_save">Save device</button>
                        </form>
                    </div>
                </div>


                <!-- AllDevicesList -->

                <div class="row my-5">
                    <!-- <div class="row justify-content-center hide" id="dev_save_text">
                        <div class="col-10">
                        <div class="alert alert-warning alert-dismissible fade show" role="alert">
                            <strong>Congratulations!</strong> Device Deleted successfully from record.
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                          </div></div>
                    </div> -->
                    <div class="col-12">
                        <div class="row d-flex justify-content-end">
                            <div class="col-1">
                                <h6>Page: {{devices.number}}/{{devices.paginator.num_pages}}</h6>
                            </div>
                            <div class="col-3">

                                <nav aria-label="Devices Page navigation">
                                    <ul class="pagination">
                                        {%if devices.has_previous%}
                                        <li class="page-item"><a class="page-link"
                                                href="{%url 'main_admin'%}?page={{devices.previous_page_number}}"><Previous></a>
                                        </li>
                                        {%endif%}
                                        {% for num_page in devices.paginator.page_range %}
                                        {% if devices.number == num_page %}
                                        <li class="page-item active">
                                            <!-- <a class="page-link"
                                                href="{%url 'main_admin'%}?page={{devices.num_page}}" >{{num_page}}</a> -->
                                                <a class="page-link"
                                                data-bs-whatever="{{num_page}}" id="dev_page">{{num_page}}</a>
                                        </li>
                                        {% else %}
                                        <li class="page-item">
                                            <!-- <a class="page-link"
                                                href="{%url 'main_admin'%}?page={{num_page}}">{{num_page}}</a> -->
                                                <a class="page-link"
                                                data-bs-whatever="{{num_page}}" id="dev_page">{{num_page}}</a>
                                        </li>
                                        {% endif %}
                                        {% endfor %}
                                        {%if devices.has_next%}
                                        <li class="page-item">
                                            <a class="page-link"
                                                href="{%url 'main_admin'%}?page={{devices.next_page_number}}">Next</a>
                                        </li>
                                        {%endif%}
                                    </ul>
                                </nav>

                            </div>

                        </div>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Vehicle</th>
                                    <th scope="col">Route</th>
                                    <th scope="col">temp</th>
                                    <th scope="col">CO</th>
                                    <th scope="col">Humidity</th>
                                    <th scope="col">Light</th>
                                    <th scope="col">Noise</th>
                                    <th scope="col">long</th>
                                    <th scope="col">lat</th>
                                    <th scope="col">Edit</th>
                                    <th scope="col">Delete</th>
                                </tr>
                            </thead>
                            <tbody id="table_body">

                                {% for device in devices%}
                                <tr>
                                    <th scope="row">{{device.device_id}}</th>
                                    <td>{{device.vehicle_no}}</td>
                                    <td>{{device.route_name}}</td>
                                    <td>{{device.temperature}}</td>
                                    <td>{{device.carbon_mono}}</td>
                                    <td>{{device.humidity}}</td>
                                    <td>{{device.light}}</td>
                                    <td>{{device.noise}}</td>
                                    <td>{{device.langitude}}</td>
                                    <td>{{device.latitude}}</td>
                                    <td>
                                        <a href="###" class="btn btn-sm ms-3  btn-primary" role="button">Edit<i
                                                class="fa-solid ms-1 fa-pen-to-square"></i></a>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                                            data-bs-whatever="{{device.device_id}}" id="btn_dev_del"
                                            data-bs-target="#btn_del_dev_modal">
                                            Delete<i class="fa-solid ms-1 fa-trash-can"></i>
                                        </button>


                                    </td>



                                </tr>
                                {%endfor%}

                            </tbody>
                        </table>

                        <!-- Delete Device modal  -->

                        <div class="modal fade" id="btn_del_dev_modal" tabindex="-1" aria-labelledby="deleteDevModal"
                            aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteDevModal">Set in JS</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                        <h4 id="del_dev_id" class="text-danger"></h4>
                                        <p style="opacity: 0.7;" class="fs-5">Make sure this device will permanently
                                            deleted. This action can not be undo.</p>

                                    </div>
                                    <div class="modal-footer">

                                        <a class="btn btn-sm btn-danger" id="del_dev_btn" role="button"
                                            data-bs-dismiss="modal">Delete<i class="fa-solid ms-1 fa-trash-can"></i></a>
                                        <button type="button" class="btn btn-sm btn-primary"
                                            data-bs-dismiss="modal">Cancel</button>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End Delete Device modal  -->



                    </div>
                </div>




                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- Devices Tab End -->



            <!-- Sensors Tab  -->

            <div class="tab-pane " id="sensors">
                all sensors with their device id
                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- Sensors Tab End -->

            <!-- Log Tab  -->

            <div class="tab-pane " id="log">
                all sensors log
                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- Log Tab End -->

            <!-- Tickting Tab  -->

            <div class="tab-pane " id="ticketing">
                <div class="row my-5">
                    <div class="col-12 my-3">
                        <form class="d-flex">
                            <input class="form-control ms-2" type="search" placeholder="Search" aria-label="Search">
                            <button class="btn btn-outline-success" type="submit">Search</button>
                        </form>
                    </div>
                </div>
                <!-- mainRow -->
                <div class="row">
                    <div class="col-12">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Username</th>
                                    <th scope="col">Devices</th>
                                    <th scope="col">temp</th>
                                    <th scope="col">CO</th>
                                    <th scope="col">Humidity</th>
                                    <th scope="col">Light</th>
                                    <th scope="col">Noise</th>
                                    <th scope="col">GPS</th>
                                </tr>
                            </thead>
                            <tbody>

                                {% for user in users%}
                                {% if not user.is_superuser%}
                                <tr>
                                    <th scope="row">{{user.id}}</th>
                                    <td>{{user.username}}</td>
                                    <td>

                                        <select class="form-select" aria-label="Default select example">
                                            <option selected disabled>Select device</option>
                                            {% for device in devices%}
                                            <option value="{{device.device_id}}">{{device.device_id}}
                                                {{device.route_name}}</option>
                                            {%endfor%}
                                        </select>
                                    </td>


                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked">
                                        </div>
                                    </td>

                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked">
                                        </div>
                                    </td>
                                </tr>
                                {%endif%}
                                {%endfor%}

                            </tbody>
                        </table>
                    </div>
                </div>







                <img src="{% static 'member/images/uog.jpg' %}" style="max-width: 400px; max-height:400px;"
                    class="img-fluid m-5 rounded-circle" alt="uog-img">
            </div>

            <!-- ticketing Tab End -->


        </div>
        <!-- End Tab Content -->
    </div>
</div>
{% include 'main/ajax.html' %}

<script src="{% static 'main/js/jquery.js' %}"> </script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
<script src="{% static 'main/js/custom.js' %}"></script>
{% include 'main/ajax.html' %}


<script>
    //  DeleteUserModal 
    var deleteModal = document.getElementById('btn_del_modal')
    deleteModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var user_name = button.getAttribute('data-bs-whatever');
        var modalTitle = deleteModal.querySelector('.modal-title');
        var modalBodyText = deleteModal.querySelector('.modal-body #del_id');
        modalTitle.textContent = " Delete '" + user_name + "' ?";
        modalBodyText.textContent = " Are you sure to delete user with username' " + user_name + "' ? ";
        del_user_id = document.getElementById('del_user_btn');
        var btn_link = "delete_user/" + user_name;
        del_user_id.textContent = " Delete ' " + user_name + " '";
        del_user_id.setAttribute("href", btn_link);
    });

    // TicketingTabJs

    // SelectUserJs

    // SelectDeviceJS
    // ------> DevicesTabJs

    // FormVisibility
    var btn_add_dev = document.getElementById('btn_add_device');
    var btn_dev_cancel = document.getElementById('device_cancel')
    var dev_form = document.getElementById('device_form');
    btn_add_dev.addEventListener('click', () => {
        dev_form.classList.remove('hide');
    });
    btn_dev_cancel.addEventListener('click', () => {
        dev_form.classList.add('hide');
    });
        // Device Delete modal
    // var deleteDevModal = document.getElementById('btn_del_dev_modal')
    // deleteDevModal.addEventListener('show.bs.modal', function (event) {
    //     var button = event.relatedTarget;
    //     var device_del_id = button.getAttribute('data-bs-whatever');
    //     var modalTitle = deleteDevModal.querySelector('.modal-title');
    //     var modalBodyText = deleteDevModal.querySelector('.modal-body #del_dev_id');
    //     modalTitle.textContent = " Delete '" + device_del_id + "' ?";
    //     modalBodyText.textContent = " Are you sure to delete device with id' " + device_del_id + "' ? ";
    //     dev_id = document.getElementById('del_dev_btn');
    //     // var btn_link = "delete_device/" + device_del_id;
    //     // dev_id.textContent = " Delete ' " + device_del_id + " '";
    //     // dev_id.setAttribute("href", btn_link);
    // });

</script>
{% endblock %}